一个节点就是一个ES实例，也就是一个java进程，生产环境中建议一台机器运行一个实例。

可以启动只有一个节点的集群。假如命名这个节点为node1，并创建一个索引test，设置分片数（主分片）和副本数（副本分片），比如shards是3，replicas是1（也就是有3个主分片，每个主分片有1个副本分片，共3个副本分片）。在es中，主分片和副本分片不能分布在同一台机器上，那么node1上有3个主分片，但是其副本分片（3个）没办法分配，整个集群状态是黄色，需要增加一台节点来解决这个问题。

通过主分片将一个索引的数据水平分散到多个节点上，实现水平扩容。主分片数在索引创建时指定，后续不能修改。一旦修改需要重建索引。

问题：如何决定分片数和节点数？

7.0开始单节点默认分片数1，副本数0，生产环境中，一旦主分片数据量过大，超过单台机器的磁盘空间，那么就需要重建索引，将数据分散到两台机器上去。如果主分片数设置过大，会导致单个分片容量很小，一个节点分片数过多，影响性能。猜测：假如在一个集群中，一个索引的分片数设置为6，分片容量20g，单个节点磁盘空间50g，那么当一个节点有两个分片后，剩余分片分配到其他节点上？或者一个集群有3台机器，那么6个分片会均匀分散到3台机器上。后者。

副本分片作备份，防止数据丢失，一定程度上也可以提高读取性能。但是副本分片设置过多，会降低系统的写性能。

ES如何保证文档均匀的分配到分片上：通过哈希取模

```
shard = has(_routing) % number_of_primary_shards
```

默认`_routing`值是文档ID，也可以自定义`_routing`值，比如按照商品的产地，这样就能将同一产地的所有商品都分配到相同的分片上。主分片一旦修改，就需要重建索引的原因也在于此。

数据量很小时，主分片数设置为1，打分会更准确。

什么时候可以关闭`doc_values`: 某字段如果不需要作排序或聚合分析时。